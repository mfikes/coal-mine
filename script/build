#!/usr/bin/env clojure
(require '[cljs.build.api])

(let [main (second *command-line-args*)
      progress-thread (doto
                       (Thread. #(while (try (Thread/sleep 500000) true
                                          (catch Throwable _ false))
                                   (println "Still building" main "...")))
                        .start)]
  (try
    (println "\nBuilding" main "...")
    (cljs.build.api/build (or (first *command-line-args*) "src")
      {:optimizations  :none
       :parallel-build true
       :target         :nodejs
       :main           (symbol main)
       :output-to      "main.js"})
    (finally (.interrupt progress-thread))))
